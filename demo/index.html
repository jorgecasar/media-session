<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>media-session demo</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="../../iron-ajax/iron-ajax.html">
    <link rel="import" href="../../iron-icons/av-icons.html">
    <link rel="import" href="../../paper-header-panel/paper-header-panel.html">
    <link rel="import" href="../../paper-toolbar/paper-toolbar.html">
    <link rel="import" href="../../paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../media-session.html">
    <link rel="import" href="../media-metadata.html">
    <link rel="import" href="../media-image.html">

    <style is="custom-style" include="iron-flex">
      body {
        margin:0
      }
      paper-header-panel {
        width: 90vw;
        height: 40vh;
        margin: 5vh 5vw;
        @apply(--shadow-elevation-2dp);
      }
      #toast {
        --paper-toast-background-color: red;
        --paper-toast-color: white;
      }
    </style>
  </head>
  <body>
    <div class="vertical-section-container centered">
      <template is="dom-bind" id="demo">
        
        <iron-ajax auto url="[[requestUrl]]" params="[[requestParams]]" on-response="handleResponse"></iron-ajax>

        <media-session on-unsupported="logEvent" on-action-registered="logEvent" on-play="logEvent" on-pause="logEvent" on-seekbackward="logEvent" on-seekforward="logEvent" on-previoustrack="logEvent" on-nexttrack="logEvent">
          <audio id="media" controls src$="[[track.file]]"></audio>
          <media-metadata title="[[track.title]]" artist="[[track.artist]]" album="[[track.album]]">
            <template is="dom-repeat" items="[[track.artwork]]">
              <media-image src="[[item.src]]" sizes="[[item.sizes]]" type="[[item.type]]"></media-image>
            </template>
          </media-metadata>
        </media-session>
        <paper-header-panel>
          <paper-toolbar>
            <h1 class="title">Media Session Log</h1>
          </paper-toolbar>
          <div>
            <ul>
            <template is="dom-repeat" items="[[events]]">
              <li>[[item]]</li>
            </template>
            </ul>
          </div>
        </paper-header-panel>
      </template>
    </div>
    <script>
      var filesEndpoint = 'https://files.freemusicarchive.org/';
      var apiEndpoint = 'https://freemusicarchive.org/api/get/';
      var apiMethod = 'tracks';
      var apiKey = 'U6VIP98FKPMBBFGT';
      var demo = document.getElementById('demo');
      demo.mediaPaused = true;
      demo.genre_id = 10;
      demo.track = {};
      demo.requestUrl = apiEndpoint + apiMethod + '.json';
      demo.requestParams = {
        api_key: apiKey,
        genre_id: demo.genre_id
      };
      demo.handleResponse = function(event, request) {
        var trackData = request.response.dataset[0];
        demo.track = {
          file: filesEndpoint + trackData.track_file,
          title: trackData.track_title,
          artist: trackData.artist_name,
          album: trackData.album_title,
          artwork: [{
            src: trackData.track_image_file + '?method=crop&width=512&height=512',
            sizes: '512x512',
            type: 'image/jpeg'
          }]
        };
      };
      demo.events = [];
      demo.logEvent = function(event, detail) {
        demo.push('events', (new Date()).toLocaleTimeString() + ': ' + event.type + (detail ? ' - ' + detail : ''));
      };
    </script>
  </body>
</html>
